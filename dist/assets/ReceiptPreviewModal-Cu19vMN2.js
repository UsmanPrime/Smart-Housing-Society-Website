import{j as e}from"./index-DJsc_qVc.js";import{r as o}from"./react-core-Ljpx9oFu.js";import{g as m,i as g,a as p,d as u}from"./fileUtils-pNjk6_ZE.js";const h=t=>{switch((t||"").toLowerCase()){case"approved":return{bg:"bg-green-100",text:"text-green-800",ring:"ring-green-200"};case"rejected":return{bg:"bg-red-100",text:"text-red-800",ring:"ring-red-200"};case"pending":return{bg:"bg-yellow-100",text:"text-yellow-800",ring:"ring-yellow-200"};case"flagged":return{bg:"bg-orange-100",text:"text-orange-800",ring:"ring-orange-200"};default:return{bg:"bg-gray-100",text:"text-gray-800",ring:"ring-gray-200"}}},f=t=>{switch((t||"").toLowerCase()){case"approved":return"✔";case"rejected":return"✖";case"pending":return"•";case"flagged":return"!";default:return"•"}};function j({status:t="pending",className:r=""}){const i=h(t);return e.jsxs("span",{className:`inline-flex items-center gap-2 px-2.5 py-1 rounded ${i.bg} ${i.text} ring-1 ${i.ring} ${r}`,title:t,children:[e.jsx("span",{children:f(t)}),e.jsx("span",{className:"capitalize text-sm",children:t})]})}function N({item:t,onApprove:r,onReject:i,onViewReceipt:n}){const[s,d]=o.useState(""),c=a=>a?new Date(a).toLocaleString():"—",l=(a="")=>/\.(png|jpe?g|webp|gif)$/i.test(a);return e.jsxs("div",{className:"rounded-xl border border-[#06164a]/20 bg-white p-5 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold text-[#06164a]",children:[t.userName||"Resident"," • ",t.flat||""]}),e.jsxs("div",{className:"text-[#06164a]/80 text-sm",children:["Charge: ",e.jsx("span",{className:"font-medium",children:t.charge})]}),e.jsxs("div",{className:"text-[#06164a]/80 text-sm",children:["Amount: ",e.jsxs("span",{className:"font-medium",children:["$",t.amount]})]}),e.jsxs("div",{className:"text-[#06164a]/80 text-sm",children:["Paid At: ",e.jsx("span",{className:"font-medium",children:c(t.paidAt)})]})]}),e.jsx(j,{status:t.status||"pending"})]}),e.jsx("button",{type:"button",onClick:()=>n(t.receiptUrl,`receipt-${t.id}`),className:"group rounded-lg overflow-hidden border border-[#06164a]/20",title:"View receipt",children:e.jsx("div",{className:"h-40 w-full bg-[#f5f6fa] flex items-center justify-center",children:l(t.receiptUrl)?e.jsx("img",{src:t.receiptUrl,alt:"Receipt preview",className:"max-h-40 object-contain",loading:"lazy"}):e.jsxs("div",{className:"text-[#06164a]",children:[e.jsx("div",{className:"text-sm",children:"PDF Receipt"}),e.jsx("div",{className:"text-xs opacity-70",children:"Click to preview"})]})})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-[#06164a] mb-2",children:"Remarks (optional)"}),e.jsx("textarea",{className:"w-full px-3 py-2 rounded-md border border-[#06164a]/30 focus:outline-none focus:ring-2 focus:ring-[#06164a]/50",rows:3,value:s,onChange:a=>d(a.target.value),placeholder:"Add a note for the resident…"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{className:"px-4 py-2 rounded-md bg-[#06164a] text-white hover:bg-[#0f335b]",onClick:()=>r(t.id,s),children:"Approve"}),e.jsx("button",{className:"px-4 py-2 rounded-md bg-white text-[#06164a] border border-[#06164a] hover:bg-[#06164a]/5",onClick:()=>i(t.id,s),children:"Reject"})]})]})}function y({isOpen:t,fileUrl:r,filename:i,onClose:n}){if(!t)return null;const s=r!=null&&r.startsWith("uploads/")?m(r):r,d=(a="")=>g(a),c=(a="")=>p(a);o.useEffect(()=>{const a=x=>x.key==="Escape"&&(n==null?void 0:n());return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[n]);const l=async()=>{if(s)try{await u(s,i||"receipt")}catch(a){console.error("Failed to download receipt:",a),alert("Failed to download receipt. Please try again.")}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:n,"aria-hidden":"true"}),e.jsxs("div",{className:"relative bg-white max-w-4xl w-[94vw] max-h-[90vh] rounded-lg shadow-xl flex flex-col",role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold text-[#06164a]",children:"Receipt Preview"}),e.jsx("button",{onClick:n,className:"text-[#06164a] hover:opacity-70 px-2 py-1 rounded",children:"Close"})]}),e.jsxs("div",{className:"p-4 flex-1 flex flex-col",children:[e.jsxs("div",{className:"h-[65vh] bg-[#f5f6fa] rounded-md overflow-auto flex items-center justify-center",children:[!s&&e.jsx("div",{className:"text-[#06164a]",children:"No file to preview."}),s&&d(s)&&e.jsx("img",{src:s,alt:"Receipt",className:"max-h-[62vh] object-contain",loading:"lazy"}),s&&c(s)&&e.jsx("iframe",{title:"Receipt PDF",src:s,className:"w-full h-[62vh] rounded-md"}),s&&!d(s)&&!c(s)&&e.jsx("div",{className:"text-[#06164a] text-sm px-4",children:"Unsupported format. Download to view."})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-3",children:[e.jsx("button",{className:"px-4 py-2 rounded-md bg-white text-[#06164a] border border-[#06164a] text-sm",onClick:l,children:"Download"}),e.jsx("button",{className:"px-4 py-2 rounded-md bg-[#06164a] text-white text-sm",onClick:n,children:"Close"})]})]})]})]})}export{N as P,y as R};
