const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CCpieWfV.css","assets/index-DSpZquNv.css"])))=>i.map(i=>d[i]);
import{j as e,N as T,F as R,_ as k}from"./index-DJsc_qVc.js";import{r as a}from"./react-core-Ljpx9oFu.js";import{a as I}from"./vendor-B9ygI19o.js";function M(){const[D,f]=a.useState(!0),[w,n]=a.useState(""),[b,x]=a.useState(!1),[y,v]=a.useState(""),[L,O]=a.useState(""),[N,j]=a.useState(""),[m,S]=a.useState(""),[l,P]=a.useState(""),[u,E]=a.useState(""),[_,C]=a.useState("");a.useEffect(()=>{(async()=>{await Promise.all([k(()=>Promise.resolve({}),__vite__mapDeps([0])),k(()=>Promise.resolve({}),__vite__mapDeps([1]))])})(),(async()=>{var d,i;try{const r=localStorage.getItem("token"),c=await I.get("/api/users/me",{headers:{Authorization:`Bearer ${r}`}});if(c.data.success){const t=c.data.user;v(t.name||""),O(t.email||""),j(t.phone||"")}f(!1)}catch(r){console.error("Load profile failed:",r),n(((i=(d=r.response)==null?void 0:d.data)==null?void 0:i.message)||"Failed to load profile"),f(!1)}})()},[]);const A=async s=>{var g,d,i,r,c;if(s.preventDefault(),n(""),C(""),l||u||m){if(!m||!l||!u)return n("To change password, fill all password fields.");if(l!==u)return n("New password and confirm password do not match.")}try{x(!0);const t=localStorage.getItem("token"),h={name:y.trim(),phone:N.trim()};l&&(h.currentPassword=m,h.newPassword=l);const p=await I.put("/api/users/me",h,{headers:{Authorization:`Bearer ${t}`}});if(p.data.success){C("Profile updated successfully"),S(""),P(""),E("");const F=localStorage.getItem("user");if(F)try{const o=JSON.parse(F);o.name=((g=p.data.user)==null?void 0:g.name)||o.name,o.email=((d=p.data.user)==null?void 0:d.email)||o.email,o.role=((i=p.data.user)==null?void 0:i.role)||o.role,localStorage.setItem("user",JSON.stringify(o)),window.dispatchEvent(new Event("user-updated"))}catch{}setTimeout(()=>{window.location.reload()},600)}x(!1)}catch(t){console.error("Save failed:",t),n(((c=(r=t.response)==null?void 0:r.data)==null?void 0:c.message)||"Failed to update profile"),x(!1)}};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-ng-light",children:[e.jsx(T,{}),e.jsx("main",{className:"flex-grow pt-40 pb-16 px-6",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"bg-gradient-to-r from-ng-blue to-ng-accent rounded-2xl shadow-lg p-8 text-white mb-6",children:[e.jsx("h1",{className:"text-4xl font-normal",style:{fontFamily:"'DM Serif Display', serif"},children:"Edit Profile"}),e.jsx("p",{className:"opacity-90",style:{fontFamily:"Poppins, sans-serif"},children:"Update your personal details and password."})]}),e.jsx("div",{className:"bg-white rounded-xl shadow p-6",children:D?e.jsx("p",{className:"text-gray-600",children:"Loading..."}):e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[w&&e.jsx("div",{className:"p-3 rounded bg-red-50 text-red-700 text-sm",children:w}),_&&e.jsx("div",{className:"p-3 rounded bg-green-50 text-green-700 text-sm",children:_}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:y,onChange:s=>v(s.target.value),className:"w-full border rounded-lg px-3 py-2",placeholder:"Your name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:L,disabled:!0,className:"w-full border rounded-lg px-3 py-2 bg-gray-100 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"text",value:N,onChange:s=>j(s.target.value),className:"w-full border rounded-lg px-3 py-2",placeholder:"Optional"})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h3",{className:"text-lg font-semibold text-ng-blue mb-2",children:"Change Password (optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx("input",{type:"password",value:m,onChange:s=>S(s.target.value),className:"border rounded-lg px-3 py-2",placeholder:"Current password"}),e.jsx("input",{type:"password",value:l,onChange:s=>P(s.target.value),className:"border rounded-lg px-3 py-2",placeholder:"New password"}),e.jsx("input",{type:"password",value:u,onChange:s=>E(s.target.value),className:"border rounded-lg px-3 py-2",placeholder:"Confirm new password"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:b,className:"px-6 py-2 rounded-lg bg-ng-blue text-white hover:bg-ng-accent disabled:opacity-60",children:b?"Saving...":"Save Changes"})})]})})]})}),e.jsx(R,{})]})}export{M as default};
