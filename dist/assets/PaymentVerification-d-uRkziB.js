import{j as s,N as P,F as N}from"./index-DJsc_qVc.js";import{r as a}from"./react-core-Ljpx9oFu.js";import{a as f}from"./api-Ca_vtYKz.js";import{P as w,R}from"./ReceiptPreviewModal-Cu19vMN2.js";import"./vendor-B9ygI19o.js";import"./fileUtils-pNjk6_ZE.js";function V(){const[x,u]=a.useState(!0),[i,g]=a.useState(""),[o,c]=a.useState([]),[l,y]=a.useState({open:!1,fileUrl:"",filename:""}),[j,n]=a.useState(""),d=a.useCallback(async()=>{u(!0),g(""),n("");try{const e=await f.get("/api/payments/receipts/pending");e.success&&c(e.payments||[])}catch(e){console.error("Error fetching pending payments:",e),g(e.message||"Failed to load pending payments.")}finally{u(!1)}},[]),h=async(e,r="")=>{try{(await f.put(`/api/payments/verification/verify/${e}`,{remarks:r})).success&&(c(p=>p.filter(m=>m._id!==e)),n("Payment verified successfully!"),setTimeout(()=>n(""),3e3))}catch(t){console.error("Approve error:",t),alert(t.message||"Approve failed. Please try again.")}},v=async(e,r)=>{if(!r||!r.trim()){alert("Please provide a rejection reason.");return}try{(await f.put(`/api/payments/verification/reject/${e}`,{rejectionReason:r})).success&&(c(p=>p.filter(m=>m._id!==e)),n("Payment rejected successfully!"),setTimeout(()=>n(""),3e3))}catch(t){console.error("Reject error:",t),alert(t.message||"Reject failed. Please try again.")}},b=(e,r="receipt")=>{y({open:!0,fileUrl:e,filename:r})};return a.useEffect(()=>{d()},[d]),s.jsxs("div",{className:"min-h-screen",children:[s.jsx(P,{}),s.jsx("main",{className:"bg-[#c3c5ce]",children:s.jsxs("section",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-10",children:[s.jsx("h2",{className:"text-center text-4xl md:text-5xl font-normal mb-8 text-[#06164a]",style:{fontFamily:"'DM Serif Display', serif"},children:"Payment Verification"}),s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("p",{className:"text-[#06164a]",children:x?"Loading pending requestsâ€¦":`${o.length} pending verification request(s)`}),s.jsx("button",{className:"px-4 py-2 rounded-md bg-white text-[#06164a] border border-[#06164a]",onClick:d,children:"Refresh"})]}),i&&s.jsx("div",{className:"rounded-md border border-red-400 bg-red-100 text-red-800 px-4 py-3 mb-6",children:i}),j&&s.jsx("div",{className:"rounded-md border border-green-400 bg-green-100 text-green-800 px-4 py-3 mb-6",children:j}),!x&&o.length===0&&!i&&s.jsx("div",{className:"rounded-md border border-green-400 bg-green-100 text-green-800 px-4 py-3",children:"No pending payments to verify."}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:o.map(e=>s.jsx(w,{item:e,onApprove:h,onReject:v,onViewReceipt:b},e._id))})]})}),s.jsx(N,{}),s.jsx(R,{isOpen:l.open,fileUrl:l.fileUrl,filename:l.filename,onClose:()=>y({open:!1,fileUrl:"",filename:""})})]})}export{V as default};
