import{r as n}from"./react-core-Ljpx9oFu.js";import{u as w}from"./useAuth-4QJvpUN4.js";const I="/api",$=()=>localStorage.getItem("token"),b=async(r,o={})=>{const u=$(),l={"Content-Type":"application/json",...u&&{Authorization:`Bearer ${u}`},...o.headers},a=await fetch(`${I}${r}`,{...o,headers:l}),c=await a.json();if(!a.ok)throw new Error(c.message||"API request failed");return c};function P(){const r=w(),[o,u]=n.useState([]),[l,a]=n.useState(!1),[c,d]=n.useState(null),m=n.useCallback(async(e={})=>{a(!0),d(null);try{const t=new URLSearchParams;e.status&&t.append("status",e.status),e.category&&t.append("category",e.category),e.priority&&t.append("priority",e.priority),e.assignedTo&&t.append("assignedTo",e.assignedTo),e.submittedBy&&t.append("submittedBy",e.submittedBy);const i=t.toString(),p=`/complaints${i?`?${i}`:""}`,s=await b(p);return u(s.data||[]),a(!1),s.data||[]}catch(t){return d(t.message),a(!1),[]}},[]),B=n.useCallback(async e=>{a(!0),d(null);try{const t=await b(`/complaints/${e}`);return a(!1),t.data}catch(t){return d(t.message),a(!1),null}},[]),y=n.useCallback((e,t={})=>{var p;const i=(p=r.user)==null?void 0:p.id;return o.filter(s=>{var g,f,h,C;const S=((g=s.submittedBy)==null?void 0:g._id)||((f=s.submittedBy)==null?void 0:f.id)||s.submittedBy,T=((h=s.assignedTo)==null?void 0:h._id)||((C=s.assignedTo)==null?void 0:C.id)||s.assignedTo;return!(e==="my"&&S!==i||e==="assigned"&&T!==i||t.status&&s.status!==t.status||t.priority&&s.priority!==t.priority||t.category&&s.category!==t.category)})},[o,r.user]),k=n.useMemo(()=>y("all",{}),[y]),A=n.useCallback(()=>m(),[m]);return{complaints:k,loading:l,error:c,fetchComplaints:m,fetchComplaintById:B,filterComplaints:y,refresh:A,user:r.user,isAuthenticated:r.isAuthenticated}}export{P as u};
