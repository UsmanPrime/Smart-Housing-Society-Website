import{j as e}from"./index-BR_n0HI9.js";import{r as l}from"./react-core-Ljpx9oFu.js";import{a as v}from"./api-B_kgTFai.js";import{g as N,d as w}from"./fileUtils-D5euisqX.js";function D({item:a,onPayNow:o}){return e.jsxs("div",{className:"rounded-lg border border-[#06164a]/20 bg-white p-4 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[#06164a] font-semibold",children:a.title}),e.jsxs("div",{className:"text-[#06164a]",children:["Amount: $",a.amount]}),e.jsxs("div",{className:"text-[#06164a]",children:["Due: ",a.dueDate]}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:a.status==="pending"?"px-2 py-1 bg-yellow-100 text-yellow-800 rounded":"px-2 py-1 bg-red-100 text-red-800 rounded",children:a.status})})]}),e.jsx("button",{className:"px-3 py-2 rounded-md bg-[#06164a] text-white hover:bg-[#0f335b]",onClick:o,children:"Pay Now"})]})}function R({onPayNow:a}){const[o,f]=l.useState("all"),[m,j]=l.useState("dueDate"),[y,x]=l.useState([]),[p,c]=l.useState(!0),[u,g]=l.useState("");l.useEffect(()=>{(async()=>{c(!0),g("");try{const n=await v.get("/api/payments/dues/my-dues");n.success&&x(n.dues||[])}catch(n){console.error("Error fetching dues:",n),g(n.message||"Failed to load payment dues")}finally{c(!1)}})()},[]);const i=[...y.filter(s=>o==="all"?!0:s.status===o)].sort((s,n)=>m==="amount"?n.amount-s.amount:new Date(s.dueDate)-new Date(n.dueDate));return e.jsxs("div",{className:"space-y-4",children:[p&&e.jsx("div",{className:"text-center text-[#06164a] py-6",children:"Loading dues..."}),u&&e.jsx("div",{className:"rounded-md border border-red-400 bg-red-100 text-red-800 px-4 py-3",children:u}),!p&&!u&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap gap-3 items-center",children:[e.jsx("label",{className:"text-[#06164a]",children:"Filter:"}),e.jsxs("select",{className:"px-3 py-2 rounded-md bg-white text-[#06164a] border border-[#06164a]",value:o,onChange:s=>f(s.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"overdue",children:"Overdue"})]}),e.jsx("label",{className:"text-[#06164a] ml-4",children:"Sort By:"}),e.jsxs("select",{className:"px-3 py-2 rounded-md bg-white text-[#06164a] border border-[#06164a]",value:m,onChange:s=>j(s.target.value),children:[e.jsx("option",{value:"dueDate",children:"Due Date"}),e.jsx("option",{value:"amount",children:"Amount"})]})]}),e.jsx("div",{className:"hidden md:block bg-white rounded-xl border border-[#06164a]/20 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-[#06164a] text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3",children:"Title"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Amount"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Due Date"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Status"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Action"})]})}),e.jsxs("tbody",{children:[i.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:s.title}),e.jsxs("td",{className:"px-4 py-3",children:["$",s.amount]}),e.jsx("td",{className:"px-4 py-3",children:s.dueDate}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:s.status==="pending"?"px-2 py-1 bg-yellow-100 text-yellow-800 rounded":"px-2 py-1 bg-red-100 text-red-800 rounded",children:s.status})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{className:"px-3 py-2 rounded-md bg-[#06164a] text-white hover:bg-[#0f335b]",onClick:()=>a(s),children:"Pay Now"})})]},s.id)),i.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-6 text-center text-[#06164a]",children:"No dues found."})})]})]})}),e.jsxs("div",{className:"md:hidden grid grid-cols-1 gap-4",children:[i.map(s=>e.jsx(D,{item:s,onPayNow:()=>a(s)},s.id)),i.length===0&&e.jsx("div",{className:"text-center text-[#06164a] py-6",children:"No dues found."})]})]})]})}function k(){const[a,o]=l.useState({from:"",to:""}),[f,m]=l.useState([]),[j,y]=l.useState(!0),[x,p]=l.useState(""),[c,u]=l.useState("all");l.useEffect(()=>{(async()=>{y(!0),p("");try{let r="/api/payments/history";const d=new URLSearchParams;a.from&&d.append("from",a.from),a.to&&d.append("to",a.to),c&&c!=="all"&&d.append("status",c),d.toString()&&(r+=`?${d.toString()}`);const h=await v.get(r);h.success&&m(h.payments||[])}catch(r){console.error("Error fetching payment history:",r),p(r.message||"Failed to load payment history")}finally{y(!1)}})()},[a.from,a.to,c]);const g=t=>{const r=new Date(t),d=a.from?new Date(a.from):null,h=a.to?new Date(a.to):null;return!(d&&r<d||h&&r>h)},b=f.filter(t=>g(t.date)),i=async t=>{if(t.receiptImageUrl)try{const r=N(t.receiptImageUrl),d=`receipt-${t._id}.${t.receiptImageUrl.split(".").pop()}`;await w(r,d)}catch(r){console.error("Failed to download receipt:",r),alert("Failed to download receipt. Please try again.")}},s=t=>{if(t.receiptImageUrl){const r=N(t.receiptImageUrl);window.open(r,"_blank")}},n=t=>t==="verified"?"px-2 py-1 bg-green-100 text-green-800 rounded text-sm":t==="rejected"?"px-2 py-1 bg-red-100 text-red-800 rounded text-sm":"px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-sm";return e.jsxs("div",{className:"space-y-4",children:[j&&e.jsx("div",{className:"text-center text-[#06164a] py-6",children:"Loading payment history..."}),x&&e.jsx("div",{className:"rounded-md border border-red-400 bg-red-100 text-red-800 px-4 py-3",children:x}),!j&&!x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap gap-3 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[#06164a] mb-1",children:"From"}),e.jsx("input",{type:"date",className:"px-3 py-2 rounded-md bg-white text-[#06164a] border border-[#06164a]",value:a.from,onChange:t=>o(r=>({...r,from:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[#06164a] mb-1",children:"To"}),e.jsx("input",{type:"date",className:"px-3 py-2 rounded-md bg-white text-[#06164a] border border-[#06164a]",value:a.to,onChange:t=>o(r=>({...r,to:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[#06164a] mb-1",children:"Status"}),e.jsxs("select",{className:"px-3 py-2 rounded-md bg-white text-[#06164a] border border-[#06164a]",value:c,onChange:t=>u(t.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"verified",children:"Verified"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]})]}),e.jsx("div",{className:"bg-white rounded-xl border border-[#06164a]/20 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-[#06164a] text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3",children:"Charge"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Amount"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Date"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Status"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Actions"})]})}),e.jsxs("tbody",{children:[b.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:t.dueTitle||t.chargeTitle||"Payment"}),e.jsxs("td",{className:"px-4 py-3",children:["PKR ",t.amount]}),e.jsx("td",{className:"px-4 py-3",children:new Date(t.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("span",{className:n(t.status),children:t.status}),t.status==="rejected"&&t.rejectionReason&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:t.rejectionReason})]}),e.jsxs("td",{className:"px-4 py-3 flex gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-md bg-[#06164a] text-white hover:bg-[#0f335b]",onClick:()=>s(t),children:"View"}),e.jsx("button",{className:"px-3 py-2 rounded-md bg-white text-[#06164a] border border-[#06164a]",onClick:()=>i(t),children:"Download"})]})]},t._id)),b.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-6 text-center text-[#06164a]",children:"No payments found."})})]})]})})]})]})}export{R as P,k as a};
