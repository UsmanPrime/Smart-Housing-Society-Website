const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CCpieWfV.css","assets/index-DSpZquNv.css"])))=>i.map(i=>d[i]);
import{j as e,N as w,F as A,_ as S}from"./index-DJsc_qVc.js";import{r as a}from"./react-core-Ljpx9oFu.js";import{A as _}from"./AnnouncementsList-iTW8_Eje.js";import{a as N}from"./vendor-B9ygI19o.js";function C({initialData:s=null,onSuccess:u,onCancel:p}){const[g,r]=a.useState(""),[x,i]=a.useState(""),[h,m]=a.useState(""),[l,c]=a.useState(!1),f=typeof window<"u"?localStorage.getItem("user"):null,o=f?JSON.parse(f):null,b=(o==null?void 0:o.role)==="admin";if(a.useEffect(()=>{if(s){r(s.title||""),i(s.content||"");const n=s.date||s.createdAt;if(n){const d=new Date(n).toISOString();m(d.slice(0,16))}else m("")}else r(""),i(""),m("")},[s]),!b)return null;const y=async n=>{var d,v;if(n.preventDefault(),!g.trim()||!x.trim())return alert("Please provide title and content");try{c(!0);const t=localStorage.getItem("token"),j={title:g.trim(),content:x.trim()};h&&(j.date=new Date(h).toISOString()),s&&s._id?await N.put(`/api/announcements/${s._id}`,j,{headers:{Authorization:`Bearer ${t}`}}):await N.post("/api/announcements",j,{headers:{Authorization:`Bearer ${t}`}}),c(!1),u&&u()}catch(t){console.error("Save failed:",t),alert(((v=(d=t.response)==null?void 0:d.data)==null?void 0:v.message)||"Failed to save announcement"),c(!1)}};return e.jsxs("form",{onSubmit:y,className:"bg-white rounded-xl shadow p-4 border space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-ng-blue",children:s?"Edit Announcement":"Create Announcement"}),s&&p&&e.jsx("button",{type:"button",onClick:p,className:"text-sm text-gray-600 hover:text-gray-900",children:"Cancel edit"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:g,onChange:n=>r(n.target.value),className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ng-blue",placeholder:"Enter title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Content"}),e.jsx("textarea",{rows:5,value:x,onChange:n=>i(n.target.value),className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ng-blue",placeholder:"Write the announcement..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date (optional)"}),e.jsx("input",{type:"datetime-local",value:h,onChange:n=>m(n.target.value),className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ng-blue"})]}),e.jsx("div",{className:"flex justify-end gap-2 pt-2",children:e.jsx("button",{type:"submit",disabled:l,className:"px-4 py-2 rounded-lg bg-ng-blue text-white hover:bg-ng-accent disabled:opacity-60",children:l?"Saving...":s?"Update":"Publish"})})]})}function k(){const[s,u]=a.useState(null),[p,g]=a.useState(""),[r,x]=a.useState(""),[i,h]=a.useState(""),[m,l]=a.useState(1),[c,f]=a.useState(10),[o,b]=a.useState({total:0,page:1,pages:1,limit:10}),y=typeof window<"u"?localStorage.getItem("user"):null,n=y?JSON.parse(y):null,d=(n==null?void 0:n.role)==="admin";a.useEffect(()=>{(async()=>{await Promise.all([S(()=>Promise.resolve({}),__vite__mapDeps([0])),S(()=>Promise.resolve({}),__vite__mapDeps([1]))])})()},[]);const v=()=>{u(null)};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-ng-light",children:[e.jsx(w,{}),e.jsx("main",{className:"flex-grow pt-40 pb-16 px-6",children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-ng-blue to-ng-accent rounded-2xl shadow-lg p-8 text-white",children:[e.jsx("h1",{className:"text-4xl font-normal mb-2",style:{fontFamily:"'DM Serif Display', serif"},children:"Announcements"}),e.jsx("p",{className:"opacity-90",style:{fontFamily:"Poppins, sans-serif"},children:"Stay updated with the latest notices from the society administration."})]}),d&&e.jsx(C,{initialData:s,onSuccess:v,onCancel:()=>u(null)}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsx("input",{type:"text",value:p,onChange:t=>{g(t.target.value),l(1)},className:"border rounded-lg px-3 py-2",placeholder:"Search title or content..."}),e.jsx("input",{type:"date",value:r,onChange:t=>{x(t.target.value),l(1)},className:"border rounded-lg px-3 py-2"}),e.jsx("input",{type:"date",value:i,onChange:t=>{h(t.target.value),l(1)},className:"border rounded-lg px-3 py-2"}),e.jsx("select",{value:c,onChange:t=>{f(parseInt(t.target.value,10)),l(1)},className:"border rounded-lg px-3 py-2",children:[5,10,20,50].map(t=>e.jsxs("option",{value:t,children:[t," per page"]},t))})]}),e.jsx(_,{onEdit:t=>u(t),showActions:d,params:{page:m,limit:c,search:p.trim(),from:r?new Date(r).toISOString():void 0,to:i?new Date(new Date(i).setHours(23,59,59,999)).toISOString():void 0},onLoaded:({pagination:t})=>{b(t||{total:0,page:1,pages:1,limit:c})}}),o.pages>1&&e.jsxs("div",{className:"flex items-center justify-between pt-2 text-sm",children:[e.jsxs("div",{className:"text-gray-600",children:["Page ",o.page," of ",o.pages," â€¢ ",o.total," total"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>l(t=>Math.max(1,t-1)),disabled:o.page<=1,className:"px-3 py-1 rounded-lg border disabled:opacity-50",children:"Prev"}),e.jsx("button",{onClick:()=>l(t=>Math.min(o.pages,t+1)),disabled:o.page>=o.pages,className:"px-3 py-1 rounded-lg border disabled:opacity-50",children:"Next"})]})]})]})]})}),e.jsx(A,{})]})}export{k as default};
