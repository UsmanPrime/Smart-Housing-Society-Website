import{j as a,N as R,F as U}from"./index-BR_n0HI9.js";import{r as s}from"./react-core-Ljpx9oFu.js";import{L as C,a as P}from"./LogFilters-D3X6PooW.js";import{a as b}from"./api-B_kgTFai.js";import"./vendor-B9ygI19o.js";function O(){const[l,S]=s.useState([]),[j,m]=s.useState(!0),[u,g]=s.useState(""),[t,f]=s.useState({from:null,to:null,user:"all",action:"all"}),[o,x]=s.useState(""),[i,c]=s.useState(1),[w,y]=s.useState(1),L=50,d=s.useCallback(async()=>{m(!0),g("");try{const e=new URLSearchParams;t.from&&e.append("from",t.from),t.to&&e.append("to",t.to),t.user&&t.user!=="all"&&e.append("userId",t.user),t.action&&t.action!=="all"&&e.append("action",t.action),o.trim()&&e.append("search",o.trim()),e.append("page",i.toString()),e.append("limit",L.toString());const p=`/api/audit/logs?${e.toString()}`,r=await b.get(p);r.success&&(S(r.logs||[]),y(r.totalPages||1))}catch(e){console.error("Error fetching audit logs:",e),g(e.message||"Failed to load audit logs")}finally{m(!1)}},[t,o,i]),N=()=>{c(1),d()},v=()=>{f({from:null,to:null,user:"all",action:"all"}),x(""),c(1)};s.useEffect(()=>{d()},[d]);const E=e=>x(e),F=async()=>{try{const e=new URLSearchParams;t.from&&e.append("from",t.from),t.to&&e.append("to",t.to),t.user&&t.user!=="all"&&e.append("userId",t.user),t.action&&t.action!=="all"&&e.append("action",t.action),o.trim()&&e.append("search",o.trim());const p=`/api/audit/export?${e.toString()}`,r=await b.get(p),h=window.URL.createObjectURL(r),n=document.createElement("a");n.href=h,n.download=`audit-logs-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(h),document.body.removeChild(n)}catch(e){console.error("Export error:",e),alert(e.message||"Failed to export logs")}};return a.jsxs("div",{className:"min-h-screen flex flex-col bg-[#c3c5ce]",children:[a.jsx(R,{}),a.jsx("main",{className:"flex-grow pt-40 pb-16 px-6",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsx("h1",{className:"text-4xl font-normal text-[#06164a] mb-8",style:{fontFamily:"'DM Serif Display', serif"},children:"Audit Logs"}),a.jsx(C,{filters:t,setFilters:f,onApply:N,onClear:v,search:o,setSearch:E}),u&&a.jsx("div",{className:"rounded-md border border-red-400 bg-red-100 text-red-800 px-4 py-3 mb-6",children:u}),a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("p",{className:"text-sm text-[#06164a]",children:j?"Loading logs...":`Showing ${l.length} log entr${l.length===1?"y":"ies"}`}),a.jsx("button",{onClick:F,className:"px-4 py-2 rounded-md bg-[#06164a] text-white hover:bg-[#0f335b]",children:"Export CSV"})]}),a.jsx(P,{logs:l,highlight:o,page:i,totalPages:w,setPage:c})]})}),a.jsx(U,{})]})}export{O as default};
