import{j as t}from"./index-DJsc_qVc.js";import{r as o}from"./react-core-Ljpx9oFu.js";import{a as N}from"./vendor-B9ygI19o.js";function O({limit:l=0,onEdit:x,showActions:b=!1,params:g={},onLoaded:h}){const[f,p]=o.useState([]),[S,d]=o.useState(!0),[y,w]=o.useState(""),[i,v]=o.useState(null),j=typeof window<"u"?localStorage.getItem("user"):null,m=j?JSON.parse(j):null,A=(m==null?void 0:m.role)==="admin",D=async()=>{var e,s;try{d(!0);const n=new URLSearchParams;l&&n.set("limit",String(l)),Object.entries(g||{}).forEach(([$,c])=>{c!=null&&String(c).length>0&&n.set($,String(c))});const a=n.toString(),u=`/api/announcements${a?`?${a}`:""}`,r=await N.get(u);r.data.success&&(p(r.data.announcements||[]),v(r.data.pagination||null),h&&h({pagination:r.data.pagination||null})),d(!1)}catch(n){console.error("Error loading announcements:",n),w(((s=(e=n.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to load announcements"),d(!1)}};o.useEffect(()=>{D()},[l,JSON.stringify(g)]);const E=async e=>{var s,n;if(confirm("Delete this announcement?"))try{const a=localStorage.getItem("token");await N.delete(`/api/announcements/${e}`,{headers:{Authorization:`Bearer ${a}`}}),p(u=>u.filter(r=>r._id!==e))}catch(a){console.error("Delete failed:",a),alert(((n=(s=a.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to delete")}};if(S)return t.jsx("div",{className:"text-gray-500 text-sm",children:"Loading announcements..."});if(y)return t.jsx("div",{className:"text-red-600 text-sm",children:y});if(!f.length)return t.jsx("div",{className:"text-gray-500 text-sm",children:"No announcements yet"});const k=e=>new Date(e).toLocaleString();return t.jsxs("div",{className:"space-y-3",children:[f.map(e=>{var s;return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:[t.jsxs("div",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-semibold text-ng-blue",children:e.title}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[k(e.date||e.createdAt),(s=e.createdBy)!=null&&s.name?` • by ${e.createdBy.name}`:""]})]}),A&&b&&t.jsxs("div",{className:"flex gap-2 shrink-0",children:[t.jsx("button",{onClick:()=>x&&x(e),className:"px-3 py-1 text-xs rounded-md bg-blue-600 text-white hover:bg-blue-700",children:"Edit"}),t.jsx("button",{onClick:()=>E(e._id),className:"px-3 py-1 text-xs rounded-md bg-red-600 text-white hover:bg-red-700",children:"Delete"})]})]}),t.jsx("p",{className:"text-gray-700 mt-2 whitespace-pre-wrap",children:e.content})]},e._id)}),i&&t.jsxs("div",{className:"text-xs text-gray-500",children:["Page ",i.page," of ",i.pages," • ",i.total," total"]})]})}export{O as A};
