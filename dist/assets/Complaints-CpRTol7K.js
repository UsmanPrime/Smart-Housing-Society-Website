import{j as e,N as S,F as k}from"./index-BR_n0HI9.js";import{r,b as M}from"./react-core-Ljpx9oFu.js";import{u as C}from"./useAuth-4QJvpUN4.js";import{u as A,S as P,P as T,C as E}from"./ComplaintDetailModal-nxr4TCG5.js";import{u as L}from"./useComplaints-BOdCs5Ff.js";import"./vendor-B9ygI19o.js";import"./api-B_kgTFai.js";const O="/assets/complaintTOP-D0_xYKN2.webp",R="/assets/complaintHOUSE-NK8YYcxj.jpg";function $({onSuccess:s}){const{user:l}=C(),{addComplaint:o,loading:i}=A(),[d,m]=r.useState("No file chosen"),[p,x]=r.useState({}),[j,h]=r.useState(null),[u,t]=r.useState("");if(!l||l.role!=="resident")return e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-6 text-center",children:[e.jsx("p",{className:"text-lg text-amber-900 mb-2",children:"Complaint Submission is for Residents Only"}),e.jsx("p",{className:"text-sm text-amber-700",children:l?l.role==="admin"?"As an admin, you can view and manage complaints but cannot create them.":"This feature is only available to residents.":"Please log in as a resident to submit complaints."})]});const c=y=>{var b,f;const n={},a=((b=y.get("title"))==null?void 0:b.trim())||"",g=((f=y.get("description"))==null?void 0:f.trim())||"";return a.length<3&&(n.title="Min 3 characters"),g.length<10&&(n.description="Min 10 characters"),n},N=async y=>{var f,v,w;y.preventDefault();const n=new FormData(y.currentTarget),a=c(n);if(x(a),Object.keys(a).length)return;t("");const g={category:n.get("category"),title:(f=n.get("title"))==null?void 0:f.trim(),description:(v=n.get("description"))==null?void 0:v.trim(),priority:n.get("priority")||"medium",location:((w=n.get("location"))==null?void 0:w.trim())||""},b=await o(g);b.success?(t("Complaint submitted successfully!"),y.currentTarget.reset(),m("No file chosen"),h(null),x({}),s&&s(b.data),setTimeout(()=>t(""),3e3)):x({submit:b.error||"Failed to submit complaint"})};return e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[u&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded",children:u}),p.submit&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:p.submit}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Complaint Category"}),e.jsxs("select",{name:"category",className:"w-full bg-[#07164a] text-white rounded-lg h-12 px-4",required:!0,disabled:i,children:[e.jsx("option",{value:"",children:"Select category"}),e.jsx("option",{value:"plumbing",children:"Plumbing"}),e.jsx("option",{value:"electrical",children:"Electrical"}),e.jsx("option",{value:"cleaning",children:"Cleaning"}),e.jsx("option",{value:"maintenance",children:"Maintenance"}),e.jsx("option",{value:"security",children:"Security"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Priority"}),e.jsxs("select",{name:"priority",className:"w-full bg-[#07164a] text-white rounded-lg h-12 px-4",defaultValue:"medium",disabled:i,children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Complaint Title"}),e.jsx("input",{name:"title",className:"w-full bg-[#07164a] text-white rounded-lg h-12 px-4",placeholder:"Enter a short title",required:!0,disabled:i}),p.title&&e.jsx("div",{className:"text-xs text-rose-500 mt-1",children:p.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Location (Optional)"}),e.jsx("input",{name:"location",className:"w-full bg-[#07164a] text-white rounded-lg h-12 px-4",placeholder:"e.g., Building A, Floor 3, Apartment 301",disabled:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Description"}),e.jsx("textarea",{name:"description",className:"w-full bg-[#07164a] text-white rounded-lg p-4 h-36",placeholder:"Describe your issue in detail",required:!0,disabled:i}),p.description&&e.jsx("div",{className:"text-xs text-rose-500 mt-1",children:p.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-400",children:"Upload Image (Coming Soon)"}),e.jsx("div",{className:"w-full bg-gray-700 text-gray-400 rounded-lg px-4 py-3 opacity-50 cursor-not-allowed",children:e.jsx("span",{className:"text-sm",children:"Image upload will be available in a future update"})})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("button",{type:"submit",className:"bg-[#07164a] text-white px-6 py-2 rounded-md hover:bg-[#0a1f6b] transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Submit complaint",disabled:i,children:i?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Submitting..."]}):"Submit Complaint"})})]})}const D=s=>{if(!s)return"";const l=Math.floor((Date.now()-new Date(s).getTime())/1e3);if(l<60)return`${l}s ago`;const o=Math.floor(l/60);if(o<60)return`${o}m ago`;const i=Math.floor(o/60);return i<24?`${i}h ago`:`${Math.floor(i/24)}d ago`},V=(s,l=110)=>(s==null?void 0:s.length)>l?s.slice(0,l-1)+"â€¦":s||"";function F({tab:s="my",onOpen:l,statusFilter:o}){const{filterComplaints:i,loading:d,error:m,fetchComplaints:p}=L(),[x,j]=r.useState({status:"",priority:"",category:""});r.useEffect(()=>{p()},[s]);const h=r.useMemo(()=>i(s,x),[i,s,x]),u=r.useMemo(()=>{if(!o)return h;if(o==="completed"){const t=new Set(["completed","resolved","closed"]);return h.filter(c=>t.has(c.status))}if(o==="open"){const t=new Set(["open","in-progress"]);return h.filter(c=>t.has(c.status))}return h.filter(t=>t.status===o)},[o,h]);return e.jsxs("div",{"aria-busy":d?"true":"false",children:[e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[e.jsxs("select",{className:"bg-[#07164a] text-white rounded-md px-3 py-2",value:x.status,onChange:t=>j(c=>({...c,status:t.target.value})),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"in-progress",children:"In Progress"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"closed",children:"Closed"})]}),e.jsxs("select",{className:"bg-[#07164a] text-white rounded-md px-3 py-2",value:x.priority,onChange:t=>j(c=>({...c,priority:t.target.value})),children:[e.jsx("option",{value:"",children:"All Priority"}),e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]}),e.jsxs("select",{className:"bg-[#07164a] text-white rounded-md px-3 py-2",value:x.category,onChange:t=>j(c=>({...c,category:t.target.value})),children:[e.jsx("option",{value:"",children:"All Categories"}),e.jsx("option",{value:"plumbing",children:"Plumbing"}),e.jsx("option",{value:"electrical",children:"Electrical"}),e.jsx("option",{value:"cleaning",children:"Cleaning"}),e.jsx("option",{value:"maintenance",children:"Maintenance"}),e.jsx("option",{value:"security",children:"Security"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsx("button",{className:"px-3 py-2 text-sm rounded-md bg-slate-200 hover:bg-slate-300 text-slate-800",onClick:()=>j({status:"",priority:"",category:""}),"aria-label":"Reset filters",children:"Reset"})]}),d&&e.jsx("div",{className:"space-y-4",children:[1,2,3].map(t=>e.jsxs("div",{className:"animate-pulse py-4 border-b border-gray-300/40",children:[e.jsx("div",{className:"h-5 bg-gray-300 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/4 mb-3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]},t))}),m&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:m}),!d&&!m&&u.length===0&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"No complaints found"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Try adjusting your filters or create a new complaint"})]}),!d&&!m&&u.length>0&&e.jsx("ul",{className:"divide-y divide-gray-300/40",children:u.map(t=>e.jsxs("li",{className:"py-4 flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-semibold text-[#06164a] truncate",children:t.title}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[t.category," â€¢ ",t.location?`${t.location} â€¢ `:"",D(t.createdAt)]}),e.jsx("p",{className:"mt-2 text-sm text-gray-700",children:V(t.description)}),e.jsxs("div",{className:"mt-2 flex gap-2 flex-wrap items-center",children:[e.jsx(P,{status:t.status}),e.jsx(T,{priority:t.priority}),t.assignedTo&&e.jsxs("span",{className:"text-xs bg-purple-600 text-white px-2 py-1 rounded",children:["Assigned: ",t.assignedTo.name||"Vendor"]}),t.comments&&t.comments.length>0&&e.jsxs("span",{className:"text-xs text-gray-600",children:["ðŸ’¬ ",t.comments.length]})]})]}),e.jsx("button",{onClick:()=>l(t),className:"bg-[#07164a] text-white px-4 py-2 rounded-md hover:bg-[#0a1f6b] transition-colors flex-shrink-0","aria-label":`Open complaint ${t._id||t.id}`,children:"View"})]},t._id||t.id))}),e.jsx("div",{className:"mt-6 text-xs text-gray-600 space-y-1",children:e.jsxs("div",{children:[e.jsx("strong",{children:"Legend:"})," Status and Priority badges indicate progress and urgency."]})})]})}const H=r.memo(F);function K(){const{user:s}=C(),[l,o]=r.useState({}),i=r.useRef({}),[d,m]=r.useState("my"),p=M(),[x,j]=r.useState(null),h=(s==null?void 0:s.role)==="admin",u=(s==null?void 0:s.role)==="vendor",t=(s==null?void 0:s.role)==="resident";r.useEffect(()=>{m(h?"all":u?"assigned":"my"),new URLSearchParams(p.search).get("status")&&u&&m("assigned")},[h,u]),r.useEffect(()=>{const a=new IntersectionObserver(g=>{g.forEach(b=>{if(b.isIntersecting){const f=b.target.dataset.section;o(v=>({...v,[f]:!0}))}})},{threshold:.2});return Object.values(i.current).forEach(g=>g&&a.observe(g)),()=>a.disconnect()},[]);const c=(a,g)=>{i.current[a]=g},N=()=>{},y=()=>{},n=[];return h?n.push({key:"all",label:"All Complaints"},{key:"my",label:"My Complaints"},{key:"assigned",label:"Assigned"}):u?n.push({key:"assigned",label:"Assigned to Me"}):n.push({key:"my",label:"My Complaints"}),e.jsxs("div",{className:"min-h-screen",children:[e.jsx(S,{}),e.jsxs("header",{ref:a=>c("hero",a),"data-section":"hero",className:"relative h-[450px] md:h-[600px] lg:h-[700px] bg-center bg-cover",style:{backgroundImage:`url(${R})`},children:[e.jsx("div",{className:"absolute inset-0 bg-black/60"}),e.jsxs("div",{className:"relative z-10 max-w-6xl mx-auto px-6 h-full flex flex-col justify-center items-center text-white pt-12 md:pt-16",children:[e.jsx("h1",{className:`text-3xl md:text-5xl font-semibold tracking-wide transition-all duration-1000 ${l.hero?"opacity-100 translate-y-0":"opacity-0 -translate-y-10"}`,children:"Complaint Management"}),e.jsx("img",{src:O,alt:"illustration",className:`mt-4 w-72 md:w-[28rem] transition-all duration-1000 delay-200 ${l.hero?"opacity-100 scale-100":"opacity-0 scale-75"}`})]})]}),e.jsx("main",{className:"bg-[#c3c5ce] py-12",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-6",children:[n.length>1&&e.jsx("div",{className:"flex gap-2 mb-6",children:n.map(a=>e.jsx("button",{onClick:()=>m(a.key),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors
                    ${d===a.key?"bg-[#07164a] text-white":"bg-white text-[#07164a] hover:bg-slate-100"}`,children:a.label},a.key))}),e.jsxs("div",{className:`grid grid-cols-1 ${u?"lg:grid-cols-1":"lg:grid-cols-2"} gap-10`,children:[t&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Submit a Complaint / Service Request"}),e.jsx("p",{className:"text-sm text-gray-700 mb-6",children:"Please fill out the form below"}),e.jsx($,{onSuccess:N})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4",children:[d==="all"&&"All Complaints",d==="my"&&"My Complaints",d==="assigned"&&"Assigned Complaints"]}),e.jsx(H,{tab:d,statusFilter:new URLSearchParams(p.search).get("status")||void 0,onOpen:a=>j(a)})]})]})]})}),e.jsx(k,{}),x&&e.jsx(E,{complaint:x,onClose:()=>j(null),onUpdate:y})]})}export{K as default};
